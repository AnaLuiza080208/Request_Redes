<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Executor de C√≥digo Python</title>
    <link rel="stylesheet" href="judge.css">

</head>
<body>

    <div class="container">
        <h2>üêç C√≥digo Python</h2>
        <div class="quadrado" style="padding-top: 0;">
            <pre id="bloco-codigo" contenteditable="true"></pre>
        </div>

        <h2>üì• Entrada (stdin)</h2>
        <div class="quadrado">
            <textarea id="stdin-input" placeholder="Digite a entrada aqui...">
</textarea>
        </div>

        <button id="run-button">Executar</button>

        <h2>üöÄ Resultado</h2>
        <div class="quadrado">
            <pre id="output-box">Clique em 'Executar' para ver o resultado...</pre>
        </div>
    </div>

    <script>
        // URL da API Judge0
        const JUDGE0_URL = "http://judge.darlon.com.br";
        const url = `${JUDGE0_URL}/submissions?base64_encoded=true&wait=true`;

        // Seleciona os elementos da p√°gina
        const runButton = document.getElementById("run-button");
        const codeBlock = document.getElementById("bloco-codigo");
        const stdinInput = document.getElementById("stdin-input");
        const outputBox = document.getElementById("output-box");

        /**
         * Fun√ß√µes Helper para Base64 com suporte a UTF-8 (caracteres especiais)
         * btoa() e atob() nativos do navegador falham com UTF-8
         */
        function utf8_to_b64(str) {
            try {
                // Converte a string para um formato que o btoa entende
                return btoa(unescape(encodeURIComponent(str)));
            } catch (e) {
                console.error("Erro ao codificar para Base64:", e);
                return "";
            }
        }

        function b64_to_utf8(str) {
            try {
                // Converte de volta para a string UTF-8 original
                return decodeURIComponent(escape(atob(str)));
            } catch (e) {
                console.error("Erro ao decodificar de Base64:", e);
                return "";
            }
        }
        
        // Fun√ß√£o principal que ser√° chamada pelo bot√£o
        async function submitCode() {
            // Pega o conte√∫do dos campos
            // .innerText √© usado para <pre> contenteditable
            const source_code = codeBlock.innerText; 
            const stdin = stdinInput.value;

            // Mostra um status de carregamento
            outputBox.style.color = "#ffff99"; // Amarelo para "carregando"
            outputBox.innerText = "Enviando submiss√£o... Aguarde...";
            runButton.disabled = true;
            runButton.innerText = "Executando...";

            // 1. Codifica para Base64
            const encoded_source = utf8_to_b64(source_code);
            const encoded_stdin = utf8_to_b64(stdin);

            // 2. Monta o Payload
            const payload = {
                source_code: encoded_source,
                language_id: 71,  // Python 3.x
                stdin: encoded_stdin,
                base64_encoded: true,
                wait: true
            };

            try {
                // 3. Envia a submiss√£o (equivalente ao requests.post)
                const response = await fetch(url, {
                    method: "POST",
                    headers: {
                        "Content-Type": "application/json"
                    },
                    body: JSON.stringify(payload)
                });

                if (!response.ok) {
                    throw new Error(`Erro HTTP! Status: ${response.status} ${response.statusText}`);
                }

                const result = await response.json();

                // 4. Decodifica a sa√≠da
                const stdout = b64_to_utf8(result.stdout || "");
                const stderr = b64_to_utf8(result.stderr || "");
                const status = result.status?.description || "Status desconhecido";
                
                // 5. Exibe o resultado
                outputBox.style.color = "#f5f5f5"; // Reseta a cor
                outputBox.innerText = `Status: ${status}\n\n` +
                                      `--- Sa√≠da Padr√£o (stdout) ---\n${stdout.trim()}\n\n` +
                                      `--- Erros (stderr) ---\n${stderr.trim()}`;

            } catch (error) {
                // Trata erros de rede, CORS, ou falhas na requisi√ß√£o
                console.error("Erro ao fazer a requisi√ß√£o:", error);
                outputBox.style.color = "#ff9999"; // Vermelho para "erro"
                outputBox.innerText = `‚ùå Erro ao fazer a requisi√ß√£o:\n${error.message}\n\n` +
                                      `(Verifique o console do navegador. Pode ser um erro de CORS se o servidor http://judge.darlon.com.br n√£o permitir.)`;
            } finally {
                // Reativa o bot√£o
                runButton.disabled = false;
                runButton.innerText = "Executar";
            }
        }

        // Adiciona o "ouvinte" de clique ao bot√£o
        runButton.addEventListener("click", submitCode);
    </script>

</body>
</html>