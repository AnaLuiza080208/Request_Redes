<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Executor de CÃ³digo</title>
  <link rel="stylesheet" href="judge.css">
</head>
<body>

  <div class="container">
    <h2>ğŸ’» Executor de CÃ³digo Online</h2>

    <div class="quadrado selecao">
      <div class="campo">
        <label for="language-select">ğŸ§  Linguagem:</label>
        <select id="language-select">
          <option value="71" selected>Python</option>
          <option value="50">C</option>
          <option value="54">C++</option>
          <option value="63">JavaScript</option>
          <option value="62">Java</option>
        </select>
      </div>

      <div class="campo">
        <label for="operation-select">ğŸ§© OperaÃ§Ã£o:</label>
        <select id="operation-select">
          <option value="soma" selected>Soma</option>
          <option value="multiplicacao">MultiplicaÃ§Ã£o</option>
        </select>
      </div>
    </div>

    <h2>ğŸ“œ CÃ³digo</h2>
    <div class="quadrado" style="padding-top: 0;">
      <pre id="bloco-codigo" contenteditable="true">a = int(input())
b = int(input())
print(a + b)</pre>
    </div>

    <h2>ğŸ“¥ Entrada (stdin)</h2>
    <div class="quadrado">
      <textarea id="stdin-input" placeholder="Digite a entrada aqui...">3
5</textarea>
    </div>

    <h2>ğŸ¯ SaÃ­da esperada</h2>
    <div class="quadrado">
      <textarea id="expected-output" placeholder="Digite a saÃ­da esperada aqui..."></textarea>
    </div>

    <button id="run-button">ğŸš€ Executar CÃ³digo</button>

    <h2>ğŸ“Š Resultado</h2>
    <div class="quadrado">
      <pre id="output-box">Clique em "Executar CÃ³digo" para ver o resultado...</pre>
    </div>
  </div>

  <script>
    const JUDGE0_URL = "http://judge.darlon.com.br";
    const url = `${JUDGE0_URL}/submissions?base64_encoded=true&wait=true`;

    const runButton = document.getElementById("run-button");
    const codeBlock = document.getElementById("bloco-codigo");
    const stdinInput = document.getElementById("stdin-input");
    const expectedOutputInput = document.getElementById("expected-output");
    const outputBox = document.getElementById("output-box");
    const languageSelect = document.getElementById("language-select");
    const operationSelect = document.getElementById("operation-select");

    // Atualiza o cÃ³digo conforme a operaÃ§Ã£o escolhida
    operationSelect.addEventListener("change", () => {
      const op = operationSelect.value;
      if (op === "soma") {
        codeBlock.innerText = `a = int(input())
b = int(input())
print(a + b)`;
      } else {
        codeBlock.innerText = `a = int(input())
b = int(input())
print(a * b)`;
      }
    });

    // FunÃ§Ãµes Base64
    function utf8_to_b64(str) {
      return btoa(unescape(encodeURIComponent(str)));
    }

    function b64_to_utf8(str) {
      return decodeURIComponent(escape(atob(str)));
    }

    // ComparaÃ§Ã£o de saÃ­da
    function compararSaida(saida, esperado) {
      saida = saida.trim();
      esperado = esperado.trim();

      if (esperado === "") return { acerto: "-", mensagem: "â„¹ï¸ Nenhuma saÃ­da esperada informada." };

      if (saida === esperado) return { acerto: 100, mensagem: "âœ… SaÃ­da correta!" };

      let minLength = Math.min(saida.length, esperado.length);
      let acertos = 0;
      for (let i = 0; i < minLength; i++) if (saida[i] === esperado[i]) acertos++;

      const porcentagem = ((acertos / esperado.length) * 100).toFixed(2);
      return { acerto: porcentagem, mensagem: `âŒ SaÃ­da incorreta (${porcentagem}% de acerto)` };
    }

    async function submitCode() {
      const source_code = codeBlock.innerText;
      const stdin = stdinInput.value;
      const expected = expectedOutputInput.value;
      const language_id = parseInt(languageSelect.value);

      outputBox.style.color = "#ffff99";
      outputBox.innerText = "â³ Enviando submissÃ£o...";
      runButton.disabled = true;
      runButton.innerText = "Executando...";

      const payload = {
        source_code: utf8_to_b64(source_code),
        stdin: utf8_to_b64(stdin),
        language_id,
        base64_encoded: true,
        wait: true
      };

      try {
        const response = await fetch(url, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify(payload)
        });

        if (!response.ok) throw new Error(`Erro HTTP ${response.status}`);
        const result = await response.json();

        const stdout = b64_to_utf8(result.stdout || "").trim();
        const stderr = b64_to_utf8(result.stderr || "").trim();
        const status = result.status?.description || "Status desconhecido";
        const comparacao = compararSaida(stdout, expected);

        outputBox.style.color = comparacao.acerto == 100 ? "#99ff99" : "#ff9999";
        outputBox.innerText =
          `Status: ${status}\n\n` +
          `--- SaÃ­da ---\n${stdout || "(vazio)"}\n\n` +
          `--- Erros ---\n${stderr || "Nenhum"}\n\n` +
          `--- ComparaÃ§Ã£o ---\n${comparacao.mensagem}`;
      } catch (error) {
        outputBox.style.color = "#ff9999";
        outputBox.innerText = `âŒ Erro: ${error.message}`;
      } finally {
        runButton.disabled = false;
        runButton.innerText = "ğŸš€ Executar CÃ³digo";
      }
    }

    runButton.addEventListener("click", submitCode);
  </script>
</body>
</html>
